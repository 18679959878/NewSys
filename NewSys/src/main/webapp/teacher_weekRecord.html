<!DOCTYPE html>
<html>
v
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>软件动漫学院准毕业生毕业设计与实习管理系统</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/jquery.wysiwyg.old-school.css">
<link rel="stylesheet" href="css/tip.css" />
<link rel="stylesheet" href="css/sumbitButton.css">
<link rel="stylesheet" href="css/examples.css">
<!-- jQuery AND jQueryUI -->
<script type="text/javascript" src="js/msgbox.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<!--<script type="text/javascript" src="js/index.js"></script>-->
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript" src="js/url.js"></script>
<link rel="stylesheet" href="css/style2.css">
<script type="text/javascript" src="js/wangEditor.min.js"></script>
<script src="js/vendor/jquery-1.11.2.min.js"></script>
<script src="js/jquery.barrating.js"></script>
<script>"undefined"==typeof CODE_LIVE&&(!function(e){var t={nonSecure:"54645",secure:"54650"},c={nonSecure:"http://",secure:"https://"},r={nonSecure:"127.0.0.1",secure:"gapdebug.local.genuitec.com"},n="https:"===window.location.protocol?"secure":"nonSecure";script=e.createElement("script"),script.type="text/javascript",script.async=!0,script.src=c[n]+r[n]+":"+t[n]+"/codelive-assets/bundle.js",e.getElementsByTagName("head")[0].appendChild(script)}(document),CODE_LIVE=!0);</script></head>
<body data-genuitec-lp-enabled="false" data-genuitec-file-id="wc1-106" data-genuitec-path="/NewSys Maven Webapp/src/main/webapp/teacher_weekRecord.html">

	<!--     内容      -->
	<div id="content" class="white" data-genuitec-lp-enabled="false" data-genuitec-file-id="wc1-106" data-genuitec-path="/NewSys Maven Webapp/src/main/webapp/teacher_weekRecord.html">
		<h1>
			<img src="images/posts.png" alt="">实习管理
		</h1>

		<!--操作栏-->
		<div class="bloc">
			<div class="title">
				操作 <a class="toggle"></a>
			</div>
			<div class="content dashboard">
				<div class="center" style="display: block; width: auto;">
					<a href="teacher_weekRecord_stu.html" class="shortcut" id="back">
						<img src="images/callback.png" alt="" width="48" height="48">
						返回上一页
					</a> <a href="teacher_weekRecord.html" id="refurbish" class="shortcut">
						<img src="images/refurbish.png" alt="" width="48" height="48">
						刷新页面
					</a>
					<div class="cb"></div>
				</div>
			</div>
		</div>


		<div class="bloc">
			<div class="title">
				实习管理 <a
					href="http://www.grafikart.fr/demo/coreadmin/index.php?p=table#"
					class="toggle"></a>
			</div>
			<div class="content">

				<div style="height: 40px;">
					<h2>实习活动</h2>
				</div>
				<div id="at_promis">
					<table>
						<tr>
							<td>实习部门：<input type="text" id="department"
								name="department" /></td>
							<td>实习地点：<input type="text" id="place" name="place" /></td>
						</tr>
					</table>

					<div id="activity"></div>
				</div>

				<div style="height: 50px;">
					<h2>指导老师意见</h2>
				</div>
				<div id="tea_opinion"></div>
				<form method="post" action="/NewSys/weekRecord/t/sop" id="add">
					<a href="javascript:void(0);" onclick="nextStu()" id="lastStu"></a>
					<div style="height: 40px;">
						<p style="margin-left: 64%; font-size: 16px;">
							字数限制80-120&nbsp;&nbsp;&nbsp;<span id="ac_error"
								style="color: red;"></span> <a href="javascript:void(0);"
								onclick="nextStu()" id="nextStu"></a>
						</p>
					</div>
					<input id="stageName" name="stageName" hidden="hidden" /> <input
						id="stuId" name="stuId" hidden="hidden" /> <input id="isLock"
						type="number" name="isLock" hidden="hidden" />
					<textarea id="guidance_t" name="guidance" hidden="hidden"></textarea>
					<div style="padding-top: 20px;padding-bottom: 40px;">
						<label>打分(总分6):</label> <select id="example-a" name="score"
							style="width: auto;">
							<option id="option0" value="0">0分</option>
							<option id="option1" value="1">1分</option>
							<option id="option2" value="2">2分</option>
							<option id="option3" value="3">3分</option>
							<option id="option4" value="4">4分</option>
							<option id="option6" value="6">6分</option>
						</select> <br> <br>
					</div>
				</form>
				<table>
					<tr>
						<td><button id="lock" onclick="tip(0)">锁&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定</button></td>
						<td style="width: 100px;"></td>
						<td>
							<button onclick="tip(1)">提&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交</button>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</div>

	<br>
	<div id="ui-datepicker-div"
		class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>
</body>
<script type="text/javascript">
	document.getElementById("stageName").value = getQueryString("stageName");
	document.getElementById("stuId").value = getQueryString("stuId");
	document.getElementById("refurbish").href = "teacher_weekRecord.html?stuId=" + getQueryString("stuId") + "&stageName=" + getQueryString("stageName");
	document.getElementById("back").href = "teacher_weekRecord_stu.html?stageName=" + getQueryString("stageName");
</script>
<script type="text/javascript">
	var lastAcNum = 0;
	var lastOpNum = 0;
	var isLock = false;
	var E = window.wangEditor;
	var activity = new E('#activity');
	activity.customConfig.menus = [
		'fontSize',
		'list',
		'justify',
		'undo',
		'redo',
	]


	activity.create();
	var E = window.wangEditor
	var tea_opinion = new E('#tea_opinion');
	tea_opinion.customConfig.menus = [ 'fontSize',
		'list',
		'justify',
		'undo',
		'redo',
	]
	tea_opinion.customConfig.onchange = function(html) {
		var length = removeHTMLTag(html).length;
		if (length > 120) {
			$("#ac_error").css("color", "red");
			$("#ac_error").html(length + "/120(超出字数限制)");
		} else if (length < 80) {
			$("#ac_error").css("color", "red");
			$("#ac_error").html(length + "/80(字数不足)");
		} else {
			$("#ac_error").css("color", "green");
			$("#ac_error").html(length + "/120(字数限制内)");
		}
		if (length <= 120 && (length - lastAcNum >= 20) || (length - lastAcNum <= -20)) {
			lastAcNum = length;
			tip(1);
		}
	}
	tea_opinion.create();
	activity.$textElem.attr('contenteditable', false);
	function removeHTMLTag(str) {
		str = str.replace(/<\/?[^>]*>/g, ''); //去除HTML tag
		str = str.replace(/[ | ]*\n/g, '\n'); //去除行尾空白
		str = str.replace(/&nbsp;/ig, ''); //去掉&nbsp;
		return str;
	}
	function tip(type) {
		if (removeHTMLTag(tea_opinion.txt.html()).length <= 120) {

			if (type == 1) {
				document.getElementById("isLock").value = 0;
			}
			$("#guidance_t").val(tea_opinion.txt.html());
			var targetUrl = $("#add").attr("action");
			var sendData = $("#add").serialize();
			$.ajax({
				url : targetUrl,
				type : 'POST', //POST
				timeout : 5000, //超时时间
				data : sendData,
				dataType : 'json', //返回的数据格式：json/xml/html/script/jsonp/text
				success : function(data) {
					if (type == 1) {
						if (data.success == true) {
							var tip = "内容已保存";
							ZENG.msgbox.show(tip, 4, 2000);
						} else {
							var tip = data.error;
							ZENG.msgbox.show(tip, 5, 2000);
						}
					} else {
						if (data.success == true) {
							var tip = "操作成功";
							ZENG.msgbox.show(tip, 4, 2000);
						} else {
							var tip = "操作失败";
							ZENG.msgbox.show(tip, 5, 2000);
						}
					}
					createData();
				},
				error : function(data) {
					var tip = "内容保存失败";
					ZENG.msgbox.show(tip, 5, 2000);
				}
			});
		} else {
			var tip = "教师评语字数超过120字限制,内容保存失败";
			ZENG.msgbox.show(tip, 5, 2000);
		}
	}
	function createData() {
		$.ajax({
			url : "/NewSys/weekRecord/sel",
			type : 'GET',
			data : "stageName=" + getQueryString("stageName") + "&stuId=" + getQueryString("stuId"),
			timeout : 5000, //超时时间
			dataType : 'json', //返回的数据格式：json/xml/html/script/jsonp/text
			success : function(data) {
				if (data.success) {
					activity.txt.html(data.data.activity);
					$("#department").val(data.data.department);
					$("#place").val(data.data.place);
					tea_opinion.txt.html(data.data.guidance);
					isLock = data.data.isLock;
					var value = data.data.score;
					alert(data.data.score);
					document.getElementById("option" + value).selected = "selected";
					loadCss("css/examples.css");
					loadJs("js/examples.js");
					if (data.data.isLock == true) {

						$("#lock").css("background", "#C0C0C0");
						document.getElementById("isLock").value = 0;
						$("#lock").html("解&nbsp;除&nbsp;锁&nbsp;定");
					} else {
						$("#lock").css("background", "");
						document.getElementById("isLock").value = 1;
						$("#lock").html("锁&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定");
					}
				} else {
					document.getElementById("option0").selected = "selected";
					loadCss("css/examples.css");
					loadJs("js/examples.js");
				}
			}
		});

	}
	createData();
	function nextStu() {
		$.ajax({
			url : "/NewSys/weekRecord/nextSub",
			type : 'GET',
			data : "stuId=" + getQueryString("stuId"),
			timeout : 5000, //超时时间
			dataType : 'json', //返回的数据格式：json/xml/html/script/jsonp/text
			success : function(data) {
				document.getElementById("nextStu").href = "/NewSys/teacher_weekRecord.html?stuId=" + data.data.stuId + "&stageName=" + getQueryString("stageName");
				document.getElementById("nextStu").innerHTML = "下一位已提交学生--" + data.data.stuName;
			}
		});
	}
	nextStu();
	function loadCss(href) {
		var link = document.createElement("link");
		link.rel = "stylesheet";
		link.type = "text/css";
		link.href = href;
		document.getElementsByTagName("head")[0].appendChild(link);
	}
	function loadJs(href) {
		var head = $("head").remove("script[role='reload']");
		$("<scri" + "pt>" + "</scr" + "ipt>").attr({
			role : 'reload',
			src : href,
			type : 'text/javascript'
		}).appendTo(head);
	}
</script>

</html>

